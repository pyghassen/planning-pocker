version: '3'
services:
  web:
    build: .
    ports:
     - "8000:8000"
    volumes:
      - ./:/opt/
    environment:
      - CACHE_HOST=cache-server

    command: "python web/manage.py runserver 0.0.0.0:8000"
    depends_on:
      - cache-server

  cache-server:
    image: "redis:5.0.4-alpine"
    ports:
     - 6379:6379

  test:
    build: .
    volumes:
      - ./:/opt/
    command: "python web/manage.py test web"
    stdin_open: true
    tty: true
